# Penetration Testing Overview

## Penetration Testing Lifecycle

- In the simplest terms, a pentest consists of two recurring stages: **discovery and attack.**
  - Discovery: Comprised of reconnaissance, enumeration, and footprinting.
  - Exploitation: Action on findings during reconnaissance phase. Exploit vulnerabilties and gain new access. Repeat discovery as new access is gained.

## Discovery

The discovery phase entails gaining information and *knowledge* about the target. This is obtained by three distinct components:

### Reconnaissance

- Passive information gathering about a system or environment.
- No interaction with systems or networks.
- Goal: obtain high level understanding of the attack surface.
- Methods:
  - Public information scraping.
  - Passive DNS enumeration.
  - Studying publicly exposed repositories or data.
- Examples:
  1. **Search Engines**: Using Google, Bing, or other search engines to find information related to the target, like exposed assets or confidential documents.

  2. **Social Media**: Observing social media platforms to gather intel about employees, their roles, and any leaky information related to the organization.

  3. **Public Records**: Searching public databases, news articles, and press releases for information that can be useful for understanding the target environment.

  4. **Job Boards**: Checking websites like LinkedIn, Indeed, or the company's career page for job postings can reveal the technologies and software they use.

  5. **Shodan/Censys**: These search engines index devices connected to the Internet and can reveal exposed servers and services.

  6. **DNS Enumeration**: Utilizing tools like `theHarvester` to passively gather subdomains, emails, and hostnames related to the target.

  7. **WHOIS Lookup**: Checking the WHOIS database for domain registration information, which may reveal points of contact, IP ranges, or domain names.

  8. **Wayback Machine**: Using web archive services to look at past versions of target websites, which may expose directories, files, or old vulnerabilities.

  9. **Certificate Transparency Logs**: Searching through logs for domains that an organization has registered could reveal additional subdomains or services.

  10. **Network Traffic Analysis**: Observing traffic patterns to and from the target network without directly interacting with it.

  11. **Github/Source Code Repositories**: Searching through publicly available code repositories to find potentially sensitive information like API keys or poorly secured code.

  12. **RSS Feeds**: Subscribing to the company's RSS feeds to get updates on new blog posts or publications that might reveal more about the organization's internal processes or technologies.

  13. **User Forums and Community Boards**: Monitoring discussions in these forums can sometimes provide insights into technologies in use, common problems faced, and even credentials.

  14. **Wi-Fi Networks**: Capturing Wi-Fi probe requests or identifying SSIDs (if in physical proximity) to understand network names without connecting to the network.

  15. **Competitor Analysis**: Studying how competitors interact with the target or what they say about the target can also offer insights into the target's operational landscape.

The information gathered through passive reconnaissance can be instrumental for future phases of a penetration test or security assessment.

### Enumeration

- Active information gathering from the target(s).
- Goal: Obtain detailed information about specific targets.
- Methods:
  - Port scanning.
  - Banner grabbing.
  - Service scanning.
  - Vulnerability scanning.
- Examples:
  1. **Ping Sweeping**: Sending ICMP echo requests to identify live hosts within a network range.

  2. **Port Scanning**: Using tools like `nmap` or `Masscan` to identify open ports and running services on target hosts.

  3. **DNS Brute-forcing**: Using tools like `subbrute` or `Sublist3r` to actively discover subdomains related to the target domain.

  4. **Banner Grabbing**: Connecting to open ports to fetch service banners, which can reveal information about the running software and its version.

  5. **Directory/File Enumeration**: Tools like `Dirbuster` or `Gobuster` can be used to find hidden files and directories on web servers.

  6. **User Enumeration**: Trying to find valid usernames through login pages or services like SSH, often through brute-forcing or dictionary attacks.

  7. **SMTP Enumeration**: Using the VRFY command to validate usernames against an SMTP server.

  8. **SNMP Enumeration**: Using SNMPwalk or other SNMP tools to extract information from SNMP-enabled devices.

  9. **LDAP Enumeration**: Querying LDAP services to gather information on users, group memberships, and permissions.

  10. **NetBIOS/SMB Enumeration**: Using tools like `nbtscan` or `enum4linux` to extract information from Windows systems.

  11. **SNMP Enumeration**: Querying SNMP services to fetch information about network devices like routers, switches, and printers.

  12. **Database Enumeration**: Attempting to gather database names, table names, or even data, usually through SQL injection or misconfigurations.

  13. **API Enumeration**: Exploring API endpoints, parameters, and methods, which can often reveal sensitive information or hidden functionality.

  14. **ARP Scanning**: Using ARP requests to discover live hosts on a local network segment.

  15. **OS Fingerprinting**: Using tools like `nmap` or `p0f` to identify the operating system of the target hosts.

  17. **Man-in-the-Middle Attacks**: Intercepting and altering network traffic between two systems to gather data.

  18. **Social Engineering**: Actively interacting with employees or systems, like phishing, to gather information or gain unauthorized access.

### Footprinting

- Combining & consolidating knowledge from reconnaissance and enumeration to understand the footprint of the target network or system.
- Goal: Map the overall attack surface and create a complete profile of the target's security posture.
- Methods:
  - Organizing recon & enumeration data.
  - Correlating findings with organizational and attack context.
  - Identifying security mechanisms such as IDS/IPS and firewalls.


## Attack

The attack phase entails acting on knowledge obtained during discovery to exploit vulnerabilities, pivot across the environment, escalate privileges, exfiltrate data, and otherwise attack the target.

### Exploitation

- The act of exploiting a vulnerability to gain new access, information, or to impact a target.
- Examples:
  1. **Remote Code Execution (RCE):** The ability to execute arbitrary code on the target machine. This is often the most critical type of exploit.

  2. **Privilege Escalation:** Elevating user privileges, either vertically (e.g., user to admin) or horizontally (e.g., accessing another user's data).

  3. **SQL Injection:** Exploiting vulnerabilities in database query code to manipulate or exfiltrate data.

  4. **Cross-Site Scripting (XSS):** Injecting malicious scripts into websites to be executed by another user's browser.

  5. File Inclusion: The ability to include files from local or remote servers, often leading to code execution or data leakage.

  6. **Information Disclosure:** Leaking sensitive information that can be used for further attacks.

  7. **Spoofing and Phishing:** Manipulating victims into revealing their credentials or installing malicious software.

  8. **Session Hijacking:** Taking over a user's session to impersonate them.

  9.  **Man-in-the-Middle (MitM) Attacks:** Intercepting and possibly altering communication between two parties.

  10. **Directory Traversal:** Navigating through the file system to access restricted directories.

  11. **Social Engineering:** Manipulating people into revealing confidential information or performing actions that compromise security.

  12. **Password Attacks:** Brute-forcing, guessing, spraying, or cracking passwords to gain further access


### Post-Exploitation

- Examples:
  1. **Data Exfiltration:** Exporting sensitive data from the target system for further analysis or for demonstrating the impact of the vulnerability.

  2. **Pivoting / Lateral Movement:** Using the compromised system to attack other systems within the same network. 

  3. **Credential Harvesting:** Collecting usernames, passwords, and other authentication tokens for later use or analysis.

  4. **Persistence:** Installing backdoors, creating new accounts, or other methods to maintain access over extended periods.

  5. **Clearing Logs:** Removing or altering logs to minimize detection or tracing.

  6. **Privilege Downgrading**: Lowering the security settings or disabling security software to make further attacks easier.

  7. **Keylogging:** Capturing user keystrokes to gather further information like passwords or intellectual property.

  8. **Screen Capture:** Taking screenshots or capturing video of the user's activity.

  9. **Data Tampering:** Modifying data to either corrupt it or change its meaning.

  11. **Service and Application Manipulation:** Changing the behavior of services and applications for malicious purposes, often to establish additional entry points or to disrupt business processes.

  12. **Implantation:** Installing additional tools to enable further access or attacks.


## Other Pentesting Lifecycle Models

The above model of discovery and exploitation is a very simplistic view of the pentesting lifecycle used for illustrative purposes. However, real-world pentesting teams use more clearly defined lifecycles for the penetration testing process.


#### 1. PTES (Penetration Testing Execution Standard)
A seven-phase framework that covers everything from pre-engagement interactions to post-exploitation cleanup.
- Pre-engagement Interactions
- Intelligence Gathering
- Threat Modeling
- Vulnerability Analysis
- Exploitation
- Post Exploitation
- Reporting

#### 2. OWASP (Open Web Application Security Project)
Though not strictly a pentesting framework, OWASP provides guidelines and tools specifically aimed at web application security.
- Planning
- Reconnaissance
- Analysis
- Exploitation
- Post-Exploitation
- Reporting

#### 3. OSSTMM (Open Source Security Testing Methodology Manual)
Focuses more on the human aspects and operational security, along with technical aspects.
- Pre-test
- Test
- Post-test
- Reporting

#### 4. NIST SP 800-115 (Technical Guide to Information Security Testing and Assessment)
Provided by the National Institute of Standards and Technology, this guide offers a comprehensive approach to security testing.
- Planning
- Discovery
- Attack
- Reporting

#### 5. MITRE ATT&CK Framework
A knowledge base used for understanding attack vectors and techniques. Often integrated into other testing frameworks.
- Initial Access
- Execution
- Persistence
- Privilege Escalation
- Defense Evasion
- Credential Access
- Discovery
- Lateral Movement
- Collection
- Exfiltration
- Command and Control
- Impact

##### 6. ISSAF (Information Systems Security Assessment Framework)
Detailed and focuses on holistic security assessment, covering everything from policy to penetration testing.
- Project Scope and Planning
- Information Gathering
- Risk Assessment
- Vulnerability Assessment
- Penetration Testing
- Reporting and Action Plan