# Common Weaknesses

- Weakness: Classes of types of attack susceptibilities in all sorts of systems
- Vulnerability: A specific instance of a weakness

## The MITRE Corporation

- Non-profit widely held as authoritative source for public vulnerability regristration 
- Most known vulnerabiities are registered with MITRE
- Maintains database of registered vulnerabilities

## MITRE Classifications

- CWE - Common Weakness Enumeration
- CVE - Common Vulnerabilities and Exposures
- CVSS - Common Vulnerability Scoring System

### CWE - Common Weakness Enumeration

#### OWASP Top 10

The OWASP top ten is the top-10 list of CWEs for a given year

---
#### A01: Broken Access Control
- Tested in 94% of applications.
- Includes 34 Common Weakness Enumerations (CWEs), having the highest number of instances across applications.

#### A02: Cryptographic Failures
- Previously referred to as Sensitive Data Exposure.
- Focuses on failures in cryptographic systems that may result in data leaks or system compromise.

#### A03: Injection
- Examined in 94% of applications.
- Includes 33 CWEs.
- Now incorporates Cross-Site Scripting.

#### A04: Insecure Design
- New category for 2021.
- Emphasizes risks related to flawed design.
- Encourages the use of threat modeling and secure design principles.

#### A05: Security Misconfiguration
- Tested in 90% of applications.
- Now incorporates XML External Entities (XXE).

#### A06: Vulnerable and Outdated Components
- Formerly known as Using Components with Known Vulnerabilities.
- Difficult to assess due to testing challenges and absence of CVE mappings.

#### A07: Identification and Authentication Failures
- Previously called Broken Authentication.
- Now covers more CWEs specifically related to identification.

#### A08: Software and Data Integrity Failures
- New category for 2021.
- Highlights issues related to assumptions about software updates and data integrity.
- Includes Insecure Deserialization from 2017.

#### A09: Security Logging and Monitoring Failures
- Formerly named Insufficient Logging & Monitoring.
- Expanded to encompass a wider range of failure types.

#### A10: Server-Side Request Forgery
- Included based on community input.
- Exhibits low occurrence rates but has high impact potential.
  

## Case Study: Server Message Block (SMB) Broken Access Control

- Software: Samba / SMB.
  - SMB is a filesharing protocol similar to FTP
  - Very common in corporate environments
  - Samba is a popular implementation of an SMB server
- CWE: Broken Access Control.
- Intended permissions not correctly applied.

### Weakness Details

In this example, a Samba server is configured with an insecure share.

```
# /etc/samba/smb.conf

[InsecureShare]
   path = /root
   browsable = yes
   read only = no
   guest ok = yes
```

#### Why is this a problem?

- Configuration allows guests to read and write `/root` folder.
- `/root` is root user home directory, often containing scripts, private keys, and other sensitive information.

### Example Exploit

- Suppose a script exists named `/root/update-server.sh`
- `update-server.sh` is invoked by a cronjob (scheduled task) and runs commands to install software updates.
- An attacker on the network can see the SMB share and because of the permissions, can also read and write it without authentication.
- The attacker copies the script to their machine, updates the contents to add them as an `ssh` user with root access.
- Since the script runs as root it is allowed to do this.
- The attacker writes the new script back to the old one.
- Cron invokes the task at the designated time and the attacker now owns the system

## Case Study: Server-Side Request Forgery (SSRF)

- Software: Web Application Server.
  - Handles HTTP requests and serves web pages.
  - Often includes features like file uploads, API integrations, and internal services.
- CWE: Server-Side Request Forgery (SSRF).
- Allows unauthorized requests to internal resources.

### Weakness Details

In this example, a web application server has an endpoint that fetches images from a URL provided by the user. The web server sits on the network perimeter of a company with other internal servers that this webserver can see.

```python
# Python Flask example of vulnerable code

@app.route('/fetch_image')
def fetch_image():
    url = request.args.get('url')
    response = requests.get(url)
    return send_file(io.BytesIO(response.content), mimetype='image/jpeg')
```

#### Why is this a problem?

- The application blindly fetches a URL without validating the domain or protocol.
- An attacker could use this endpoint to fetch internal resources such as AWS metadata, database credentials, or even launch attacks on internal systems.

### Eample Exploit

- Suppose the internal network has a database at `hxxp://192.168.1.50:8080`.
- An attacker can make the web application issue a request to this internal IP by visiting: `hxxp://webapp.com/fetch_image?url=http://192.168.1.50:8080`.
- This could expose sensitive database information or even execute malicious operations if the internal service has vulnerabilities.

### Further Exploit Scenario

- If an internal service runs with elevated permissions and trusts requests - coming from the web application, then using SSRF, an attacker can potentially perform unauthorized actions.
- For example, if there's an internal API at `hxxp://192.168.1.51:8080/` reset, an attacker can reset the system by exploiting the SSRF vulnerability.

## References

- https://www.mitre.org/
- https://cwe.mitre.org/
  