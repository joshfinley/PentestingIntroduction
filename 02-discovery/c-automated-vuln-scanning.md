# Vulnerability Scanning

Vulnerability scanning is an essential aspect of cybersecurity practices. This process is automated to identify vulnerabilities in systems, networks, or applications.

## What is Vulnerability Scanning?

- An automated process that identifies vulnerabilities.
- Can be performed on systems, networks, and applications.
- Not to be confused with penetration testing, which is a more in-depth, manual process.

## Why is Vulnerability Scanning Important?

1. **Early Detection**: Identifies vulnerabilities before they can be exploited.
2. **Compliance**: Helps in meeting regulatory and compliance requirements.
3. **Risk Assessment**: Helps in evaluating the security posture of the organization.
4. **Resource Allocation**: Helps businesses prioritize their security needs.

## Types of Vulnerability Scanners

### Network Scanners
- Examine the network for misconfigured devices, open ports, and other network-level vulnerabilities.

### Web Application Scanners
- Focused on identifying vulnerabilities like SQL Injection, XSS, CSRF in web applications.

### Static Application Scanners
- Analyze source code for vulnerabilities during the development phase.

### Dynamic Application Scanners
- Scan running applications in real-time to identify vulnerabilities.


## Vendor Solutions

- Qualys
- Nessus
- OpenVAS
- OWASP ZAP

## Case Study: Unpatched Apache Server

- Software: Apache Web Server
  - Open-source web server software.
  - Highly configurable and extendable.
- CWE: Improper Restriction of Operations within the Bounds of a Memory Buffer.
- Allows unauthorized remote code execution.

### Weakness Details

In this example, an Apache Web server is running an outdated and unpatched version vulnerable to buffer overflow.


#### Why is this a problem?

- Running an outdated version exposes the server to known vulnerabilities.
- Buffer overflow can allow an attacker to execute arbitrary code.

### Example Exploit

- An attacker can send a specially crafted request to overflow the buffer and execute arbitrary code.

```bash
curl -H "Host: vulnerable" -H "Range: bytes=0-18446744073709551615" http://target-server/
```

- This request will trigger the vulnerability, and if carefully crafted, it can lead to unauthorized access or data leakage.


## Vulnerability Scanning in Action: Detecting the Apache Web Server Issue

### Scanning Tools Used

- Nessus
- OpenVAS

### Scanning Process

1. **Initiate Scan**: The scanner starts by initiating a scan targeting the IP address or the domain name of the Apache Web Server.
2. **Port Scanning**: The scanner identifies open ports and services running. In this case, it finds that port 80 is open and running Apache Web Server.
3. **Version Detection**: Through banner grabbing or other techniques, the scanner identifies the version of Apache running.
4. **Vulnerability Lookup**: The scanner checks its database for known vulnerabilities that affect the detected version of Apache.
5. **Attempt Exploitation**: Depending on the configuration, some scanners may try to exploit the vulnerability to confirm its presence. However, this step might be optional or not recommended for production systems.

### Scanner Output Example

```
Host: 192.168.1.10
Port: 80
Service: Apache Web Server
Version: 2.4.29
Vulnerability: CVE-2018-1312
Severity: High
Description: Buffer Overflow in Apache 2.4.29 allows remote code execution
```

#### Why is this a problem?

- The scanner successfully detected that the server is running a vulnerable version of Apache.
- It flags this as a high-severity issue, indicating immediate attention is required.

### Remediation Steps

- Update the Apache Web Server to the latest version or a version that has patched the identified vulnerability.
- Rescan the system to confirm the vulnerability has been addressed.

## Integrating Vulnerability Scanning in the DevOps Process

### Why Integrate?

- **Early Detection**: Catching vulnerabilities early in the development cycle reduces the cost and complexity of remediation.
- **Continuous Monitoring**: DevOps is all about continuous integration and continuous deployment (CI/CD); integrating vulnerability scanning ensures continuous security monitoring.

### Integration Points

#### 1. Source Code Repository

- **Tool**: Static Application Security Testing (SAST) Tools
- **When**: Every commit or pull request
- **What**: Scan the source code for vulnerabilities.

#### 2. Build Server

- **Tool**: Software Composition Analysis (SCA) Tools
- **When**: Every build
- **What**: Scan dependencies for known vulnerabilities.

#### 3. Staging Environment

- **Tool**: Dynamic Application Security Testing (DAST) Tools
- **When**: Before deploying to the production environment
- **What**: Perform automated security tests on the application in an environment that closely mimics production.

#### 4. Production Environment

- **Tool**: Network Scanners like Nessus, OpenVAS
- **When**: Periodically
- **What**: Scan the production environment for new vulnerabilities.

### Implementation Strategies

1. **Pipeline Integration**: Embed security tools directly into the CI/CD pipeline.
2. **Automated Alerts**: Configure the tools to send alerts if they find vulnerabilities, so that issues can be addressed as soon as they are discovered.
3. **Feedback Loop**: Create a process where the development team can easily receive and act upon the vulnerabilities found.

### Example DevOps Pipeline with Vulnerability Scanning

1. **Developer commits code**: The code is automatically checked by SAST tools.
2. **Build Triggered**: If SAST is passed, the build server compiles the code and SCA tools check dependencies.
3. **Deploy to Staging**: If the build is successful, the code is deployed to a staging environment where DAST tools run automated tests.
4. **Deploy to Production**: If all tests pass, the code is deployed to the production environment.
5. **Periodic Scanning**: Network scanners periodically scan the production environment for vulnerabilities.

### Metrics to Monitor

- **Number of Discovered Vulnerabilities**: Over time, this number should decrease.
- **Time to Remediate**: Measures how quickly vulnerabilities are addressed once discovered.
- **False Positive Rate**: High rates may indicate a need to adjust scanner settings.


## Best Practices

1. **Regular Scanning**: Conduct scans at regular intervals.
2. **After Updates**: Perform a scan after any major system or application update.
3. **Multi-layer Scanning**: Use different types of scanners for comprehensive coverage.
4. **Review and Act**: Always review the scan reports and act on the findings.


## Weaknesses of the Vulnerability Scanning Approach

### 1. False Positives and Negatives

- **Issue**: Scanners may report vulnerabilities that don't actually pose a threat (false positives) or miss real vulnerabilities (false negatives).
- **Impact**: False positives waste time and resources, while false negatives leave you exposed.
  
### 2. Lack of Context
  
- **Issue**: Automated tools lack the context that a human security analyst may have.
- **Impact**: This can lead to overlooking vulnerabilities that are not apparent through automated analysis or marking low-risk vulnerabilities as high-risk.
  
### 3. Incomplete Coverage
  
- **Issue**: No tool can check for every possible vulnerability.
- **Impact**: Some types of vulnerabilities may go unnoticed unless manual checks are conducted.
  
### 4. Resource Intensive

- **Issue**: Some scanning tools are resource-intensive and can affect system performance.
- **Impact**: This could lead to slower build and deployment times, potentially affecting release schedules.

### 5. Skill and Knowledge Gap

- **Issue**: Properly configuring and interpreting the results of a vulnerability scanner requires a level of expertise.
- **Impact**: Incorrectly configured scanners or misinterpreted results can lead to gaps in security coverage.

### 6. Compliance != Security

- **Issue**: Passing a vulnerability scan may be necessary for compliance but isn't sufficient to ensure security.
- **Impact**: Focusing solely on passing scans can lead to a check-box mentality that overlooks broader security issues.

### Countermeasures

1. **Manual Review**: Complement automated scanning with manual code reviews and penetration testing for more comprehensive coverage.
2. **Regular Updates**: Keep  scanning tools up-to-date to ensure they are equipped to detect the latest vulnerabilities.
3. **Training**: Continuously educate and train teams to properly configure and use scanning tools.
4. **Holistic Approach**: Use vulnerability scanning as one component in a multi-layered security strategy.
   

## References

- [Qualys](https://www.qualys.com/)
- [Nessus](https://www.tenable.com/products/nessus)
- [OpenVAS](https://www.openvas.org/)
- [OWASP ZAP](https://www.zaproxy.org/)
